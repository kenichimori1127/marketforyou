<h1>DM</h1>

<h4>参加者</h4>

<% @entries.each do |e| %>
    <% if e.user_id.present? && user = User.find_by(id: e.user_id) %>
    <div class="message-user">
        <h5><strong><a href="/users/<%= user.id %>"><%= "#{user.nickname}さん" %></a></strong></h5>
    <% elsif e.staff_id.present? && staff = Staff.find_by(id: e.staff_id)%>
        <h5><strong><a href="/staffs/<%= staff.id %>"><%= "#{staff.nickname}さん" %></a></strong></h5>
    <% end %>
<% end %>
<hr>

  <% if @messages.present? %>
    <% @messages.each do |m| %>
      <strong><%= m.content %></strong>
      <% if m.user_id.present? && user = User.find_by(id: m.user_id) %>
          <small>by<strong><a href="/users/<%= user.id %>"><%= "#{user.nickname}さん" %><small><%= l user.created_at %></a></small></strong></small>
      <% elsif m.staff_id.present? && staff = Staff.find_by(id: m.staff_id)%>
          <small>by<strong><a href="/staffs/<%= staff.id %>"><%= "#{staff.nickname}さん" %><small><%= l staff.created_at %></a></small></strong></small>
      <% end %>
  <hr>
    <% end %>
  <% else %>
    <h3 class="text-center">メッセージはまだありません</h3>
  <% end %>

<div class="form">
  <div class="form-input">
    <%= form_for @message do |f| %>
      <%= f.text_field :content, class: 'form-message', placeholder: "メッセージを入力して下さい", :size => 150 %>
      <%= f.hidden_field :room_id, :value => @room.id %>
  </div>
</div>
      <%= f.submit "送信", class: 'form-submit'%>
    <% end %>

<script>
    const form = document.getElementById("new_message");

    form.addEventListener("submit", function (event) {
        const content = document.getElementById("message_content").value;
        if (content != '') {

        } else {
            event.preventDefault();
            alert("メッセージを入力してください。");
            const submit_btn = document.getElementById("submit_btn");
            submit_btn.removeAttribute('data-disable-with');
        }
    });
</script>
